Streams
Usage
Subscribing
To use the websocket API, connect to wss://ws.backpack.exchange.

To subscribe to a stream with the name stream send a text frame over the websocket connection with the following JSON payload:

{
  "method": "SUBSCRIBE",
  "params": ["stream"]
}
Similarly, to unsubscribe from a stream with the name stream:

{
  "method": "UNSUBSCRIBE",
  "params": ["stream"]
}
You can subscribe or unsubscribe from multiple streams if you include more than one in the params field.

All data from streams is wrapped in a JSON object of the following form:

{
  "stream": "<stream>",
  "data": "<payload>"
}
The following command can be used to test subscribing to a stream:

(sleep 1; \
echo '{"method":"SUBSCRIBE","params":["depth.SOL_USDC"]}';\
cat) |\
wscat -c wss://ws.backpack.exchange
The payloads for each stream time are outlined below.

Timing
Timestamps are in microseconds (except for the K-line start and end times). The event timestamp is the time the event was emitted from the websocket server, and the engine timestamp is the time the event was generated by the matching engine.

If a message aggregates more than one event (for example, a depth message), the engine timestamp will be the timestamp of the last matching engine event.

Keeping the connection alive
To keep the connection alive, a Ping frame will be sent from the server every 60s, and a Pong is expected to be received from the client. If a Pong is not received within 120s, a Close frame will be sent and the connection will be closed.

If the server is shutting down, a Close frame will be sent and then a grace period of 30s will be given before the connection is closed. The client should reconnect after receiving the Close frame. The client will be reconnected to a server that is not shutting down.

Private
Subscribing to a private stream requires a valid signature generated from an ED25519 keypair. For stream subscriptions, the signature should be of the form:

instruction=subscribe&timestamp=1614550000000&window=5000
Where the timestamp and window are in milliseconds.

Private streams are prefixed with account. and require signature data to be submitted in the subscribe parameters. The verifying key and signature should be base64 encoded.

{
  "method": "SUBSCRIBE",
  "params": ["stream"],
  "signature": ["<verifying key>", "<signature>", "<timestamp>", "<window>"]
}
Order update
On any mutation to an order the order will be pushed to the order update stream. The event type of the order update will be one of the following:

orderAccepted
orderCancelled
orderExpired
orderFill
orderModified
triggerPlaced
triggerFailed
An orderModified update will be received when a resting reduce only order's quantity is decreased in order to prevent position side reversal.

Stream Name Format
For all markets: account.orderUpdate
For single market: account.orderUpdate.<symbol>
{
  "e": "orderAccepted",   // Event type
  "E": 1694687692980000,  // Event time in microseconds
  "s": "SOL_USD",         // Symbol
  "c": 123,               // Client order ID
  "S": "Bid",             // Side
  "o": "LIMIT",           // Order type
  "f": "GTC",             // Time in force
  "q": "32123",           // Quantity
  "Q": "32123",           // Quantity in quote
  "p": "20",              // Price
  "P": "21",              // Trigger price
  "B": "LastPrice",       // Trigger by
  "a": "30",              // Take profit trigger price
  "b": "10",              // Stop loss trigger price
  "j": "30",              // Take profit limit price
  "k": "10",              // Stop loss limit price
  "d": "MarkPrice",       // Take profit trigger by
  "g": "IndexPrice",      // Stop loss trigger by
  "Y": "10",              // Trigger quantity
  "X": "New",             // Order state
  "R": "PRICE_BAND",      // Order expiry reason
  "i": "1111343026172067" // Order ID
  "t": 567,               // Trade ID
  "l": "1.23",            // Fill quantity
  "z": "321",             // Executed quantity
  "Z": "123",             // Executed quantity in quote
  "L": "20",              // Fill price
  "m": true,              // Whether the order was maker
  "n": "23",              // Fee
  "N": "USD",             // Fee symbol
  "V": "RejectTaker",     // Self trade prevention
  "T": 1694687692989999,  // Engine timestamp in microseconds
  "O": "USER"             // Origin of the update
  "I": "1111343026156135" // Related order ID
  "H": 6023471188         // Strategy ID
  "y": true               // Post only
}
There are several possible values for the O field (origin of the update):

USER: The origin of the update was due to order entry by the user.
LIQUIDATION_AUTOCLOSE: The origin of the update was due to a liquidation by the liquidation engine.
ADL_AUTOCLOSE: The origin of the update was due to an ADL (auto-deleveraging) event.
COLLATERAL_CONVERSION: The origin of the update was due to a collateral conversion to settle debt on the account.
SETTLEMENT_AUTOCLOSE: The origin of the update was due to the settlement of a position on a dated market.
BACKSTOP_LIQUIDITY_PROVIDER: The origin of the update was due to a backstop liquidity provider facilitating a liquidation.
Some fields are conditional on the order settings or event type:

c - Only present if the order has a client order ID.
q - Only present if the order has a quantity set.
Q - Only present if the order is reverse market order.
p - Only present if the order is a limit order.
P - Only present if the order is a trigger order.
B - Only present if the order is a trigger order.
a - Only present if the order has a take profit trigger price set.
b - Only present if the order has a stop loss trigger price set.
d - Only present if the order has a take profit trigger price set.
g - Only present if the order has a stop loss trigger price set.
Y - Only present if the order is a trigger order.
R - Only present if the event is a orderExpired event.
t - Only present if the event is a orderFill event.
l - Only present if the event is a orderFill event.
L - Only present if the event is a orderFill event.
m - Only present if the event is a orderFill event.
n - Only present if the event is a orderFill event.
N - Only present if the event is a orderFill event.
Position update
On any mutation to a position the position will be pushed to the position update stream. The event type of the position update will be one of the following:

positionAdjusted
positionOpened
positionClosed
On subscription, a message will be sent to the client with the current open positions, if any. The e field will not be present in the message.

Stream Name Format
For all markets: account.positionUpdate
For single market: account.positionUpdate.<symbol>
{
  "e": "positionOpened",  // Event type
  "E": 1694687692980000,  // Event time in microseconds
  "s": "SOL_USDC_PERP",    // Symbol
  "b": 123,               // Break event price
  "B": 122,               // Entry price
  "f": 0.5,               // Initial margin fraction
  "M": 122,               // Mark price
  "m": 0.01,              // Maintenance margin fraction
  "q": 5,                 // Net quantity
  "Q": 6,                 // Net exposure quantity
  "n": 732 ,              // Net exposure notional
  "i": "1111343026172067" // Position ID
  "p": "-1",              // PnL realized
  "P": "0",               // PnL unrealized
  "T": 1694687692989999   // Engine timestamp in microseconds
}
The net quantity field will be positive if the position is long and negative if the position is short.

The net exposure quantity field includes exposure from the open position, as well as any open orders.

RFQ Update
This WebSocket stream provides real-time updates on RFQs (Request for Quotes) that are relevant to makers. Events are pushed to this stream whenever there is a significant state change in an RFQ or its associated quotes, allowing makers to monitor and respond to RFQs as they progress through various states.

Event Types
For RFQs that submitted by other requesters.

rfqActive: Indicates that an RFQ is active and open for quotes.
For RFQs that submitted by your account.

rfqAccepted: Indicates that an RFQ has been accepted and is no
rfqRefreshed: Indicates that an RFQ has been refreshed, is active and open for quotes.
rfqCancelled: Indicates that an RFQ has been cancelled or expired.
rfqCandidate: RFQ has received a new best quote.
rfqFilled: Indicates that an RFQ has been fully filled with a quote.
For Quotes submitted by your account.

quoteAccepted: Indicates that a quote submitted by the maker has been accepted.
quoteCancelled: Indicates that a quote has been cancelled due to quote submission, RFQ being filled, refreshed, cancelled, or expired.
Quote Submission and RFQ Timing
Makers should submit quotes before the submission time (w field) is reached, as indicated in each rfqActive event. An RFQ remains active until the expiration time (W field). If no quote is accepted or the RFQ is not cancelled, makers may continue to submit quotes until expiration.

RFQs can periodically request new quotes by issuing additional rfqActive events. Each new rfqActive event will have the same RFQ ID (R field) but updated values for submission time and expiration time, allowing makers to participate in extended or renewed quoting periods for ongoing RFQs.

Stream Name Format
For all markets: account.rfqUpdate
For single market: account.rfqUpdate.<symbol>
Example Messages
RFQ Accepted (sent to requester)

{
  "e": "rfqAccepted",            // Event type
  "E": 1730225420369829,         // Event time in microseconds
  "R": 113392053149171712,       // RFQ ID
  "C": "123",                    // Client RFQ ID
  "s": "SOL_USDC_RFQ",           // Symbol
  "S": "Bid",                    // RFQ side
  "q": "10",                     // Quantity (if quantity in base asset)
  "w": 1730225480368,            // Submission time in milliseconds
  "W": 1730225540368,            // Expiry time in milliseconds
  "X": "New",                    // RFQ status
  "T": 1730225420368765          // Engine timestamp in microseconds
}
RFQ Active (broadcast to all rfq listeners)

{
  "e": "rfqActive",              // Event type
  "E": 1730225420369829,         // Event time in microseconds
  "R": 113392053149171712,       // RFQ ID
  "s": "SOL_USDC_RFQ",           // Symbol
  "q": "10",                     // Quantity (optional) (if quantity in base asset)
  "w": 1730225480368,            // Submission time in milliseconds
  "W": 1730225540368,            // Expiry time in milliseconds
  "X": "New",                    // RFQ status
  "T": 1730225420368765          // Engine timestamp in microseconds
}
RFQ Refreshed (sent to requester)

{
  "e": "rfqRefreshed",           // Event type
  "E": 1730225450369829,         // Event time in microseconds
  "R": 113392053149171712,       // RFQ ID
  "C": "123",                    // Client RFQ ID
  "s": "SOL_USDC_RFQ",           // Symbol
  "S": "Bid",                    // RFQ side
  "q": "10",                     // Quantity (optional) (if quantity in base asset)
  "w": 1730225480368,            // Submission time in milliseconds
  "W": 1730225540368,            // Expiry time in milliseconds
  "X": "New",                    // RFQ status
  "T": 1730225450368765          // Engine timestamp in microseconds
}
RFQ Cancelled (sent to taker only)

{
  "e": "rfqCancelled",           // Event type
  "E": 1730225460369829,         // Event time in microseconds
  "R": 113392053149171712,       // RFQ ID
  "C": "123",                    // Client RFQ ID
  "s": "SOL_USDC_RFQ",           // Symbol
  "S": "Bid",                    // RFQ side
  "Q": "150",                    // Quote quantity (optional) (if quantity in quote asset)
  "w": 1730225480368,            // Submission time in milliseconds
  "W": 1730225540368,            // Expiry time in milliseconds
  "X": "Cancelled",              // RFQ status
  "T": 1730225460368765          // Engine timestamp in microseconds
}
Quote Accepted (sent to quoter)

{
  "e": "quoteAccepted",          // Event type
  "E": 1730225434631394,         // Event time in microseconds
  "R": 113392053149171712,       // RFQ ID
  "u": 113392054083780608,       // Quote ID
  "C": "123",                    // Client Quote ID
  "s": "SOL_USDC_RFQ",           // Symbol
  "X": "New",                    // Quote status
  "T": 1730225434629778          // Engine timestamp in microseconds
}
Quote Cancelled (sent to quoter)

{
  "e": "quoteCancelled",         // Event type
  "E": 1730225583761963,         // Event time in microseconds
  "R": 113392061354344448,       // RFQ ID
  "u": 113392062870847488,       // Quote ID
  "C": "123",                    // Client Quote ID
  "s": "SOL_USDC_RFQ",           // Symbol
  "X": "Cancelled",              // Quote status
  "T": 1730225583753811          // Engine timestamp in microseconds
}
RFQ Candidate (sent to requester with quote details)

{
  "e": "rfqCandidate",           // Event type
  "E": 1730225490648996,         // Event time in microseconds
  "R": 113392053149171712,       // RFQ ID
  "u": 113392054083780608,       // Quote ID
  "C": "123",                    // Client RFQ ID
  "s": "SOL_USDC_RFQ",           // Symbol
  "S": "Bid",                    // RFQ side
  "q": "10",                     // RFQ quantity (in base asset)
  "Q": "150",                    // RFQ quote quantity (in quote asset)
  "p": "15.50",                  // Taker price (quote price + fee)
  "X": "New",                    // RFQ status
  "T": 1730225490647080          // Engine timestamp in microseconds
}
RFQ Filled (sent to both requester and quoter)

// To requester
{
  "e": "rfqFilled",              // Event type
  "E": 1730225497648996,         // Event time in microseconds
  "R": 113392053149171712,       // RFQ ID
  "u": 113392054083780608,       // Quote ID
  "C": "123",                    // Client RFQ ID
  "s": "SOL_USDC_RFQ",           // Symbol
  "S": "Bid",                    // RFQ side
  "Q": "150",                    // RFQ quote quantity (optional) (if quantity in quote asset)
  "p": "15.50",                  // Taker price (quote price + fee)
  "X": "Filled",                 // RFQ status
  "T": 1730225497647080          // Engine timestamp in microseconds
}

// To quoter
{
  "e": "rfqFilled",              // Event type
  "E": 1730225497648996,         // Event time in microseconds
  "R": 113392053149171712,       // RFQ ID
  "u": 113392054083780608,       // Quote ID
  "C": "123",                    // Client Quote ID
  "s": "SOL_USDC_RFQ",           // Symbol
  "p": "15.00",                  // Price
  "X": "Filled",                 // Quote status
  "T": 1730225497647080          // Engine timestamp in microseconds
}
Field Descriptions
e - Event type (e.g., rfqActive, rfqAccepted, rfqRefreshed, rfqCancelled, quoteAccepted, quoteCancelled, rfqCandidate, rfqFilled).
E - Event time in microseconds.
R - RFQ ID, identifying the request for quote.
u - Quote ID, identifying the specific quote.
C - Client ID (either Client RFQ ID or Client Quote ID depending on context).
s - Symbol the RFQ is for.
S - Side of the RFQ, either "Bid" or "Ask".
q - Quantity for the RFQ (in base asset, if quantity in base asset).
Q - Quote quantity for the RFQ (in quote asset, if quantity in quote asset).
p - Price associated with the quote/fill event.
w - Submission time for the RFQ in milliseconds.
W - Expiry time for the RFQ in milliseconds.
X - Order status (e.g., New, Cancelled, Filled).
T - Engine timestamp in microseconds.
Some fields are conditional and may be present only in specific events. RFQs are either requested in base quantity or quote quantity, but not both. Either q or Q will be present.

Public
Book ticker
Stream name format: bookTicker.<symbol>

{
  "e": "bookTicker",          // Event type
  "E": 1694687965941000,      // Event time in microseconds
  "s": "SOL_USDC",            // Symbol
  "a": "18.70",               // Inside ask price
  "A": "1.000",               // Inside ask quantity
  "b": "18.67",               // Inside bid price
  "B": "2.000",               // Inside bid quantity
  "u": "111063070525358080",  // Update ID of event
  "T": 1694687965940999       // Engine timestamp in microseconds
}
Depth
Contains incremental depth updates. Each depth update has the absolute value of the depths at the given levels, and only changes when the depth has changed.

To obtain an initial snapshot of the depth, the client should query the REST API.

The depth stream will push updates as quickly as possible, but under load it may aggregate more than one update into a single event. In this case the U and u fields will not be the same. The U field is the first update ID in the event, and the u field is the final update ID in the event.

There are alternative depth streams that aggregates updates into a single message over a 200ms, 600ms or 1000ms period instead of pushing updates in realtime. This is useful for reducing network traffic.

Updates are sequential, so U will always be u + 1 from the previous message. If this is not the case, the client should assume that the depth has been invalidated and requery the REST API.

Stream name format: depth.<symbol> (realtime) Stream name format: depth.200ms.<symbol> (aggregated) Stream name format: depth.600ms.<symbol> (aggregated) Stream name format: depth.1000ms.<symbol> (aggregated)

{
  "e": "depth",           // Event type
  "E": 1694687965941000,  // Event time in microseconds
  "s": "SOL_USDC",        // Symbol
  "a": [                  // Asks
    [
      "18.70",
      "0.000"
    ]
  ],
  "b": [                  // Bids
    [
      "18.67",
      "0.832"
    ],
    [
      "18.68",
      "0.000"
    ]
  ],
  "U": 94978271,          // First update ID in event
  "u": 94978271,          // Last update ID in event
  "T": 1694687965940999   // Engine timestamp in microseconds
}
K-Line
Stream name format: kline.<interval>.<symbol>

{
  "e": "kline",                   // Event type
  "E": 1694687692980000,          // Event time in microseconds
  "s": "SOL_USD",                 // Symbol
  "t": "2024-09-11T12:00:00",     // K-Line start time (ISO 8601 format)
  "T": "2024-09-11T12:01:00",     // K-Line close time (ISO 8601 format)
  "o": "18.75",                   // Open price
  "c": "19.25",                   // Close price
  "h": "19.80",                   // High price
  "l": "18.50",                   // Low price
  "v": "32123",                   // Base asset volume
  "n": 93828,                     // Number of trades
  "X": false                      // Is this k-line closed?
}
Liquidation
Contains updates for liquidation events for all liquidation types.

Stream name format: liquidation

{
  "e": "liquidation",         // Event type
  "E": 1694688638091000,      // Event time in microseconds
  "q": "10",                  // Quantity
  "p": "18.70",               // Price
  "S": "Bid",                 // Side
  "s": "SOL_USDC",            // Symbol
  "T": 567,                   // Engine timestamp in microseconds
}
Mark price
Stream name format: markPrice.<symbol>

{
  "e": "markPrice",           // Event type
  "E": 1694687965941000,      // Event time in microseconds
  "s": "SOL_USDC",            // Symbol
  "p": "18.70",               // Mark price
  "f": "1.70",                // Estimated funding rate. Not included for prediction markets
  "i": "19.70",               // Index price. Not included for prediction markets
  "n": 1694687965941,         // Next funding timestamp in milliseconds. Not included for prediction markets
  "T": 1694687965940999       // Engine timestamp in microseconds
}
Ticker
The ticker stream pushes 24hr rolling statistics for a single symbol every second.

Stream name format: ticker.<symbol>

{
  "e": "ticker",          // Event type
  "E": 1694687692980000,  // Event time in microseconds
  "s": "SOL_USD",         // Symbol
  "o": "18.75",           // First price
  "c": "19.24",           // Last price
  "h": "19.80",           // High price
  "l": "18.50",           // Low price
  "v": "32123",           // Base asset volume
  "V": "928190",          // Quote asset volume
  "n": 93828              // Number of trades
}
Open interest
Open interest updates are pushed to the openInterest stream every 60 seconds.

Stream name format: openInterest.<symbol>

{
  "e": "openInterest",          // Event type
  "E": 1694687965941000,        // Event time in microseconds
  "s": "SOL_USDC_PERP",         // Symbol
  "o": "100",                   // Open interest in contracts
}
Trade
Contains public trade data for a single symbol. The trade ID is a sequential number specific to the symbol. This stream includes updates for trades executed as a result of liquidations.

Stream name format: trade.<symbol>

{
  "e": "trade",                   // Event type
  "E": 1694688638091000,          // Event time in microseconds
  "s": "SOL_USDC",                // Symbol
  "p": "18.68",                   // Price
  "q": "0.122",                   // Quantity
  "b": "111063114377265150",      // Buyer order ID
  "a": "111063114585735170",      // Seller order ID
  "t": 12345,                     // Trade ID
  "T": 1694688638089000,          // Engine timestamp in microseconds
  "m": true                       // Is the buyer the maker?
}